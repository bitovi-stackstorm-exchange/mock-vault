version: 1.0

description: return a kv store key with a short ttl of a config value

input:
  - secret_name
  - config_value_2fa

tasks:
  generate_key:
    action: core.noop
    next:
      - when: <% succeeded() and ctx().secret_name = "2fa" %>
        publish:
          - kv_key: "vault_2fa_RANDOM_GENERATED"
        do: create_temp_kv_2fa

  create_temp_kv_2fa:
    action: st2.kv.set
    input:
      key: <% ctx().kv_key %>
      value: <% ctx().config_value_2fa %>
      ttl: 60

output:
  - kv_name: <% ctx().kv_key %>